<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover" />
<title>Focus Pomodoro</title>
<link rel="manifest" href="manifest.json">

<style>
/* ===== ORIGINAL UI ‚Äî MOBILE OPTIMIZED PATCH ===== */
:root{--bg:#000;--fg:#fff;--border:#fff;--soft:#111;--gap:14px}
body.light{--bg:#fff;--fg:#000;--border:#000;--soft:#eee}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}

/* keep centered layout like your original */
body{
 margin:0;
 background:var(--bg);
 color:var(--fg);
 font-family:monospace;
 min-height:100vh;
 display:flex;
 justify-content:center;
 align-items:center; /* centered restored */
 padding:env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
 transition:.35s;
}

/* keep same visual style but scale safely */
.card,.login,.about{
 width:520px;
 max-width:100%;
 border:2px solid var(--border);
 padding:18px;
 animation:fade .5s ease;
}

.stack>*{margin-top:var(--gap)}

h1{text-align:center;font-size:16px;letter-spacing:2px;margin:0}
.small{font-size:12px;opacity:.75;text-align:center}

.row{display:flex;gap:8px;flex-wrap:wrap}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}

button,input,select{
 border:1px solid var(--border);
 background:var(--bg);
 color:var(--fg);
 font-family:monospace;
 border-radius:8px;
}

/* iOS zoom fix */
input,select{padding:14px 12px;font-size:16px;width:100%}
button{padding:14px 8px;font-size:13px;cursor:pointer;transition:.18s}
button:hover{background:var(--soft)}
button:active{transform:scale(.96)}

/* ===== TIMER ‚Äî SAME LOOK, RESPONSIVE SIZE ===== */
.circle{
 position:relative;
 width:min(70vw,210px);
 height:min(70vw,210px);
 margin:0 auto;
}

svg{width:100%;height:100%;transform:rotate(-90deg)}
.bg{fill:none;stroke:var(--border);stroke-width:6;opacity:.2}
.fg{fill:none;stroke:var(--border);stroke-width:6;stroke-dasharray:565;stroke-dashoffset:565;transition:stroke-dashoffset 1s linear}

.time{
 position:absolute;inset:0;
 display:flex;align-items:center;justify-content:center;
 font-size:clamp(30px,6vw,40px);
 transition:.25s;
}
.time.tick{transform:scale(1.08)}

.overlay{position:fixed;inset:0;background:var(--bg);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:9999}
.overlay.show{display:flex}

.history{max-height:160px;overflow:auto;border-top:1px solid var(--border);padding-top:8px;font-size:12px}
.item{padding:6px 0;border-bottom:1px dashed var(--border);animation:slide .3s ease}

.tree{text-align:center;font-size:14px}

/* rain bg unchanged */
.rain{
 position:fixed;inset:0;pointer-events:none;opacity:.15;display:none;
 background-image:repeating-linear-gradient(180deg,var(--fg) 0 2px,transparent 2px 20px);
 animation:rain 0.6s linear infinite;
}
.rain.on{display:block}
@keyframes rain{from{background-position:0 0}to{background-position:0 40px}}

.socials{display:flex;gap:12px;justify-content:center}
.socials a{font-size:22px;text-decoration:none}

@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1}}
@keyframes slide{from{opacity:0;transform:translateX(-6px)}to{opacity:1}}

/* ===== MOBILE ONLY ‚Äî keep UI same but tighter ===== */
@media(max-width:480px){
 .card,.login,.about{padding:14px;border-width:1.5px}
 .grid3{grid-template-columns:1fr}
 .row{flex-direction:column}
 button{padding:16px 10px}
}

/* desktop unchanged */
@media(min-width:700px){
 .card,.login,.about{padding:18px;border-width:2px}
}
</style>
</head>
<body>

<div class="rain" id="rainFx"></div>

<!-- LOGIN -->
<div class="login stack" id="loginPage">
<h1>FOCUS LOGIN</h1>
<input id="user" placeholder="username">
<input id="pass" placeholder="password" type="password">
<div class="grid3">
<button onclick="signup()">SIGN UP</button>
<button onclick="login()">LOGIN</button>
<button onclick="guestLogin()">GUEST</button>
</div>
<div class="small">Password once lost cannot be recovered.</div>
<div class="small"><button onclick="showAbout()">ABOUT DEV</button></div>
</div>

<!-- ABOUT PAGE -->
<div class="about stack" id="aboutPage" style="display:none">
<h1>ABOUT THE DEVELOPER</h1>
<div class="small">
Hi, I'm <b>Prabesh Khati</b> ‚Äî a software engineering student who enjoys experimenting with AI systems, UI design, and building practical tools that people actually use.
</div>
<div class="socials">
<a href="https://www.linkedin.com/in/prabesh-khati-564627373?utm_source=share_via&utm_content=profile&utm_medium=member_ios" target="_blank">üíº</a>
<a href="https://github.com/prabeshkhati1" target="_blank">üêô</a>
</div>
<button onclick="hideAbout()">BACK</button>
</div>

<!-- OVERLAY -->
<div class="overlay" id="lockOverlay">
<h1>FOCUS LOCK</h1>
<div class="small">Session active ‚Äî return to focus</div>
</div>

<!-- APP -->
<div class="card stack" id="app" style="display:none">
<h1>FOCUS TIMER</h1>

<div class="row">
<select id="subjectSel"></select>
<button onclick="addSubject()">+ SUBJECT</button>
<button onclick="toggleTheme()" id="themeBtn">LIGHT</button>
</div>

<div class="circle">
<svg>
<circle cx="105" cy="105" r="90" class="bg"></circle>
<circle cx="105" cy="105" r="90" class="fg" id="ring"></circle>
</svg>
<div class="time" id="time">25:00</div>
</div>

<div class="grid3">
<button onclick="start()">START</button>
<button onclick="pause()">PAUSE</button>
<button onclick="reset()">RESET</button>
</div>

<div class="row">
<input id="focusMin" placeholder="focus" type="number">
<input id="breakMin" placeholder="break" type="number">
<button onclick="applyCustom()">SET</button>
</div>

<div class="grid3">
<button onclick="toggleLock()" id="lockBtn">LOCK OFF</button>
<button onclick="toggleRain()" id="rainBtn">RAIN OFF</button>
<button onclick="logout()">LOGOUT</button>
</div>

<div class="tree" id="tree"></div>
<div class="history" id="history"></div>
</div>

<script>
/* ===== AUTH ===== */
function signup(){localStorage.acc_user=user.value;localStorage.acc_pass=pass.value;alert("Account created")}
function login(){
 if(user.value===localStorage.acc_user && pass.value===localStorage.acc_pass) enter();
 else alert("Invalid username or password");
}
function guestLogin(){enter()}
function logout(){pause();loginPage.style.display="block";aboutPage.style.display="none";app.style.display="none"}
function enter(){loginPage.style.display="none";aboutPage.style.display="none";app.style.display="block";initSubjects();draw();render()}

/* ABOUT */
function showAbout(){loginPage.style.display="none";aboutPage.style.display="block"}
function hideAbout(){aboutPage.style.display="none";loginPage.style.display="block"}

/* THEME */
function toggleTheme(){document.body.classList.toggle('light');themeBtn.textContent=document.body.classList.contains('light')?"DARK":"LIGHT"}

/* SUBJECTS */
function initSubjects(){const s=JSON.parse(localStorage.subs||'["General"]');subjectSel.innerHTML=s.map(x=>`<option>${x}</option>`).join('')}
function addSubject(){const n=prompt("Subject name");if(!n)return;const s=JSON.parse(localStorage.subs||"[]");s.push(n);localStorage.subs=JSON.stringify(s);initSubjects()}

/* TIMER */
let focus=25, brk=5, left=1500, total=1500, t=null, isFocus=true, lock=false;
const CIRC=565;

function fmt(s){return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0')}
function draw(){time.textContent=fmt(left);ring.style.strokeDashoffset=CIRC-((total-left)/total)*CIRC}
function tick(){left--;time.classList.add('tick');setTimeout(()=>time.classList.remove('tick'),120);if(left<=0)done();draw()}

function start(){soundStart();if(lock) goFS(); if(!t)t=setInterval(tick,1000)}
function pause(){soundCancel();clearInterval(t);t=null}
function reset(){pause();left=(isFocus?focus:brk)*60;total=left;draw()}
function done(){soundDone();pause();save();isFocus=!isFocus;left=(isFocus?focus:brk)*60;total=left;unlockBreak();draw()}

function applyCustom(){const f=parseInt(focusMin.value),b=parseInt(breakMin.value);if(f>0)focus=f;if(b>0)brk=b;reset()}

/* AUDIO ‚Äî shared context */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function tone(freq,dur){const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=freq;o.start();g.gain.exponentialRampToValueAtTime(.0001,audioCtx.currentTime+dur)}
function soundStart(){tone(520,.2)}
function soundDone(){tone(880,.35)}
function soundCancel(){tone(260,.2)}

/* RAIN */
function toggleRain(){rainFx.classList.toggle('on');rainBtn.textContent=rainFx.classList.contains('on')?"RAIN ON":"RAIN OFF"}

/* LOCK */
function toggleLock(){lock=!lock;lockBtn.textContent=lock?"LOCK ON":"LOCK OFF"}
function goFS(){document.documentElement.requestFullscreen?.()}
window.addEventListener('blur',()=>{if(lock&&isFocus&&t)lockOverlay.classList.add('show')})
document.addEventListener('visibilitychange',()=>{if(document.hidden&&lock&&isFocus&&t)lockOverlay.classList.add('show')})
function unlockBreak(){if(!isFocus)lockOverlay.classList.remove('show')}

/* DATA */
function save(){const arr=JSON.parse(localStorage.pomo||"[]");arr.unshift({s:subjectSel.value,m:focus});localStorage.pomo=JSON.stringify(arr);render();grow(arr.length)}
function grow(n){tree.textContent=[".","üå±","üåø","üå≥"][Math.min(3,Math.floor(n/2))]}
function render(){const arr=JSON.parse(localStorage.pomo||"[]");history.innerHTML=arr.map(x=>`<div class=item>${x.s} ‚Äî ${x.m}m</div>`).join('')}

if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js')}
</script>
</body>
</html>
